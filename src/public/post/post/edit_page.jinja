{% extends "layout.jinja" %}

{% block page_header %}
  <title>Post List - Azu App</title>
  <meta name="description" content="Edit post in your Azu application">
{% endblock %}

{% block page_body %}
<div class="container py-4">
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="/posts" class="text-decoration-none">
              <i class="bi bi-house me-1"></i>
              Posts
            </a>
          </li>
          <li class="breadcrumb-item">
            <a href="/posts/{{ post.id }}" class="text-decoration-none">
              <i class="bi bi-eye me-1"></i>
              Post #{{ post.id }}
            </a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">
            <i class="bi bi-pencil me-1"></i>
            Edit
          </li>
        </ol>
      </nav>

      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h3 mb-0 text-white">
            <i class="bi bi-pencil-square me-2"></i>
            Post List
          </h1>
          <p class="text-muted mb-0">Update the information for post #{{ post.id }}</p>
        </div>
        <div class="btn-group" role="group">
          <a href="/posts/{{ post.id }}" class="btn btn-outline-secondary">
            <i class="bi bi-eye me-2"></i>
            View Details
          </a>
          <a href="/posts" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>
            Back to List
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Form Card -->
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card border-secondary">
        <div class="card-header border-secondary">
          <h5 class="mb-0 text-white">
            <i class="bi bi-pencil-square me-2"></i>
            Edit Post Information
          </h5>
        </div>
        <div class="card-body">
          <form action="/posts" method="POST" class="needs-validation" novalidate>
            <!-- CSRF Token -->
            <input type="hidden" name="_token" value="{{ csrf_token }}">
            <input type="hidden" name="_method" value="PATCH">

            <!-- Form Fields -->
            
              
              <div class="mb-3">
                <label for="name" class="form-label text-white">
                  Name
                  
                    <span class="text-danger">*</span>
                  
                </label>

                
                  <input
                    type="text"
                    class="form-control text-white border-secondary"
                    id="name"
                    name="name"
                    placeholder="Enter name"
                    value="{% if post.name %}{{ post.name }}{% elif form %}{{ form.name }}{% endif %}"
                    required
                  >
                

                <div class="invalid-feedback">
                  Please provide a valid name.
                </div>

                <!-- Field-specific help text -->
                
              </div>
            
              
              <div class="mb-3">
                <label for="content" class="form-label text-white">
                  Content
                  
                    <span class="text-danger">*</span>
                  
                </label>

                
                  <textarea
                    class="form-control text-white border-secondary"
                    id="content"
                    name="content"
                    rows="4"
                    placeholder="Enter content"
                    required
                  >{% if post.content %}{{ post.content }}{% elif form %}{{ form.content }}{% endif %}</textarea>
                

                <div class="invalid-feedback">
                  Please provide a valid content.
                </div>

                <!-- Field-specific help text -->
                
              </div>
            

            <!-- Form Actions -->
            <div class="d-flex justify-content-between align-items-center pt-3 border-top border-secondary">
              <div>
                <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                  <i class="bi bi-arrow-clockwise me-2"></i>
                  Reset Changes
                </button>
                <button type="button" class="btn btn-outline-danger" onclick="deletePost({{ post.id }})">
                  <i class="bi bi-trash me-2"></i>
                  Delete
                </button>
              </div>
              <div class="btn-group" role="group">
                <a href="/posts/{{ post.id }}" class="btn btn-outline-secondary">
                  <i class="bi bi-x-circle me-2"></i>
                  Cancel
                </a>
                <button type="submit" class="btn btn-warning">
                  <i class="bi bi-check-circle me-2"></i>
                  Update Post
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Form validation
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();

// Reset form functionality
function resetForm() {
  if (confirm('Are you sure you want to reset the form? All changes will be lost.')) {
    document.querySelector('form').reset();
    document.querySelector('form').classList.remove('was-validated');
  }
}

// Delete functionality
function deletePost(id) {
  if (confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
    fetch(`/posts/${id}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content')
      }
    })
    .then(response => {
      if (response.ok) {
        window.location.href = '/posts';
      } else {
        alert('Error deleting post');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error deleting post');
    });
  }
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.key === 's') {
    e.preventDefault();
    document.querySelector('button[type="submit"]').click();
  } else if (e.ctrlKey && e.key === 'r') {
    e.preventDefault();
    resetForm();
  } else if (e.key === 'Escape') {
    window.location.href = '/posts/{{ post.id }}';
  }
});
</script>
{% endblock %}
