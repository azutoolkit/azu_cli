{% extends "layout.jinja" %}

{% block page_header %}
  <title>Post List - Azu App</title>
  <meta name="description" content="View post details in your Azu application">
{% endblock %}

{% block page_body %}
<div class="container py-4">
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="/posts" class="text-decoration-none">
              <i class="bi bi-house me-1"></i>
              Posts
            </a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">
            <i class="bi bi-eye me-1"></i>
            Post #{{ post.id }}
          </li>
        </ol>
      </nav>

      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h3 mb-0 text-white">
            <i class="bi bi-eye me-2"></i>
            Post List
          </h1>
          <p class="text-muted mb-0">Viewing details for post #{{ post.id }}</p>
        </div>
        <div class="btn-group" role="group">
          <a href="/posts" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>
            Back to List
          </a>
          <a href="/posts/{{ post.id }}/edit" class="btn btn-warning">
            <i class="bi bi-pencil me-2"></i>
            Edit
          </a>
          <button type="button" class="btn btn-danger" onclick="deletePost({{ post.id }})">
            <i class="bi bi-trash me-2"></i>
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="row">
    <!-- Details Card -->
    <div class="col-lg-8">
      <div class="card  border-secondary mb-4">
        <div class="card-header  border-secondary">
          <h5 class="mb-0 text-white">
            <i class="bi bi-info-circle me-2"></i>
            Post Information
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            
              <div class="col-md-6 mb-3">
                <div class="d-flex flex-column">
                  <label class="form-label text-muted small mb-1">
                    <i class="bi bi-tag me-1"></i>
                    Name
                  </label>
                  <div class="text-white">
                    {% if post.name %}
                      {% if name == 'email' %}
                        <a href="mailto:{{ post.name }}" class="text-decoration-none">
                          <i class="bi bi-envelope me-1"></i>
                          {{ post.name }}
                        </a>
                      {% elif name == 'url' or name == 'website' %}
                        <a href="{{ post.name }}" target="_blank" class="text-decoration-none">
                          <i class="bi bi-link-45deg me-1"></i>
                          {{ post.name }}
                        </a>
                      {% elif name == 'bool' or name == 'boolean' %}
                        {% if post.name %}
                          <span class="badge bg-success">
                            <i class="bi bi-check-circle me-1"></i>
                            Yes
                          </span>
                        {% else %}
                          <span class="badge bg-danger">
                            <i class="bi bi-x-circle me-1"></i>
                            No
                          </span>
                        {% endif %}
                      {% elif name == 'created_at' or name == 'updated_at' %}
                        <i class="bi bi-calendar me-1"></i>
                        {{ post.name|datetime }}
                      {% elif name == 'id' %}
                        <span class="badge bg-secondary">
                          <i class="bi bi-hash me-1"></i>
                          {{ post.name }}
                        </span>
                      {% else %}
                        {{ post.name }}
                      {% endif %}
                    {% else %}
                      <span class="text-muted">
                        <i class="bi bi-dash me-1"></i>
                        Not provided
                      </span>
                    {% endif %}
                  </div>
                </div>
              </div>
            
              <div class="col-md-6 mb-3">
                <div class="d-flex flex-column">
                  <label class="form-label text-muted small mb-1">
                    <i class="bi bi-tag me-1"></i>
                    Content
                  </label>
                  <div class="text-white">
                    {% if post.content %}
                      {% if content == 'email' %}
                        <a href="mailto:{{ post.content }}" class="text-decoration-none">
                          <i class="bi bi-envelope me-1"></i>
                          {{ post.content }}
                        </a>
                      {% elif content == 'url' or content == 'website' %}
                        <a href="{{ post.content }}" target="_blank" class="text-decoration-none">
                          <i class="bi bi-link-45deg me-1"></i>
                          {{ post.content }}
                        </a>
                      {% elif content == 'bool' or content == 'boolean' %}
                        {% if post.content %}
                          <span class="badge bg-success">
                            <i class="bi bi-check-circle me-1"></i>
                            Yes
                          </span>
                        {% else %}
                          <span class="badge bg-danger">
                            <i class="bi bi-x-circle me-1"></i>
                            No
                          </span>
                        {% endif %}
                      {% elif content == 'created_at' or content == 'updated_at' %}
                        <i class="bi bi-calendar me-1"></i>
                        {{ post.content|datetime }}
                      {% elif content == 'id' %}
                        <span class="badge bg-secondary">
                          <i class="bi bi-hash me-1"></i>
                          {{ post.content }}
                        </span>
                      {% else %}
                        {{ post.content }}
                      {% endif %}
                    {% else %}
                      <span class="text-muted">
                        <i class="bi bi-dash me-1"></i>
                        Not provided
                      </span>
                    {% endif %}
                  </div>
                </div>
              </div>
            
          </div>
        </div>
      </div>

      <!-- Related Content (if any) -->
      <div class="card  border-secondary">
        <div class="card-header  border-secondary">
          <h5 class="mb-0 text-white">
            <i class="bi bi-diagram-3 me-2"></i>
            Related Content
          </h5>
        </div>
        <div class="card-body">
          <div class="text-center text-muted py-4">
            <i class="bi bi-inbox display-4 d-block mb-3"></i>
            <h6>No related content available</h6>
            <p class="small">Related content will appear here when available</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
      <!-- Quick Actions -->
      <div class="card  border-secondary mb-4">
        <div class="card-header  border-secondary">
          <h6 class="mb-0 text-white">
            <i class="bi bi-lightning me-2"></i>
            Quick Actions
          </h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a href="/posts/{{ post.id }}/edit" class="btn btn-warning btn-sm">
              <i class="bi bi-pencil me-2"></i>
              Edit Post
            </a>
            <button type="button" class="btn btn-danger btn-sm" onclick="deletePost({{ post.id }})">
              <i class="bi bi-trash me-2"></i>
              Delete Post
            </button>
            <a href="/posts/new" class="btn btn-primary btn-sm">
              <i class="bi bi-plus-circle me-2"></i>
              Create New Post
            </a>
          </div>
        </div>
      </div>

      <!-- Metadata -->
      <div class="card  border-secondary mb-4">
        <div class="card-header  border-secondary">
          <h6 class="mb-0 text-white">
            <i class="bi bi-gear me-2"></i>
            Metadata
          </h6>
        </div>
        <div class="card-body">
          <div class="row g-2">
            <div class="col-6">
              <small class="text-muted">ID</small>
              <div class="text-white">{{ post.id }}</div>
            </div>
            <div class="col-6">
              <small class="text-muted">Status</small>
              <div>
                <span class="badge bg-success">
                  <i class="bi bi-check-circle me-1"></i>
                  Active
                </span>
              </div>
            </div>
            <div class="col-12">
              <small class="text-muted">Created</small>
              <div class="text-white">
                <i class="bi bi-calendar-plus me-1"></i>
                {% if post.created_at %}{{ post.created_at|datetime }}{% endif %}
              </div>
            </div>
            <div class="col-12">
              <small class="text-muted">Last Updated</small>
              <div class="text-white">
                <i class="bi bi-calendar-check me-1"></i>
                {% if post.updated_at %}{{ post.updated_at|datetime }}{% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Share -->
      <div class="card  border-secondary">
        <div class="card-header  border-secondary">
          <h6 class="mb-0 text-white">
            <i class="bi bi-share me-2"></i>
            Share
          </h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <button type="button" class="btn btn-outline-primary btn-sm" onclick="copyToClipboard(window.location.href)">
              <i class="bi bi-link-45deg me-2"></i>
              Copy Link
            </button>
            <button type="button" class="btn btn-outline-info btn-sm" onclick="shareViaEmail()">
              <i class="bi bi-envelope me-2"></i>
              Share via Email
            </button>
            <button type="button" class="btn btn-outline-success btn-sm" onclick="exportData()">
              <i class="bi bi-download me-2"></i>
              Export Data
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content  border-secondary">
      <div class="modal-header border-secondary">
        <h5 class="modal-title text-white" id="deleteModalLabel">
          <i class="bi bi-exclamation-triangle text-warning me-2"></i>
          Confirm Delete
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-white">
        <p>Are you sure you want to delete this post? This action cannot be undone.</p>
        <div class="alert alert-warning">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <strong>Warning:</strong> This will permanently remove the post and all associated data.
        </div>
      </div>
      <div class="modal-footer border-secondary">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDelete">
          <i class="bi bi-trash me-2"></i>
          Delete Permanently
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Delete functionality
function deletePost(id) {
  const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
  modal.show();

  document.getElementById('confirmDelete').onclick = function() {
    fetch(`/posts/${id}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content')
      }
    })
    .then(response => {
      if (response.ok) {
        window.location.href = '/posts';
      } else {
        alert('Error deleting post');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error deleting post');
    });
  };
}

// Copy to clipboard functionality
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(function() {
    // Show success message
    const toast = document.createElement('div');
    toast.className = 'position-fixed top-0 end-0 p-3';
    toast.style.zIndex = '1055';
    toast.innerHTML = `
      <div class="toast bg-success text-white" role="alert">
        <div class="toast-body">
          <i class="bi bi-check-circle me-2"></i>
          Link copied to clipboard!
        </div>
      </div>
    `;
    document.body.appendChild(toast);

    const bsToast = new bootstrap.Toast(toast.querySelector('.toast'));
    bsToast.show();

    setTimeout(() => {
      document.body.removeChild(toast);
    }, 3000);
  });
}

// Share via email
function shareViaEmail() {
  const subject = encodeURIComponent('Post Details');
  const body = encodeURIComponent(`Check out this post: ${window.location.href}`);
  window.open(`mailto:?subject=${subject}&body=${body}`);
}

// Export data
function exportData() {
  const url = `/posts/{{ post.id }}/export`;
  window.open(url, '_blank');
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
  if (e.key === 'e' && e.ctrlKey) {
    e.preventDefault();
    window.location.href = '/posts/{{ post.id }}/edit';
  } else if (e.key === 'Delete' && e.ctrlKey) {
    e.preventDefault();
    deletePost({{ post.id }});
  } else if (e.key === 'Escape') {
    window.location.href = '/posts';
  }
});
</script>
{% endblock %}
